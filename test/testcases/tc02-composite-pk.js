const expect = require('chai').expect;
const { generateCodes } = require('../../dist/cli/generate');

describe('복합키 모델 테스트', () => {
	const model = {
		table: 'product_variant',
		title: '품목정보',
		columns: {
			product_no: {
				title: '상품번호',
				type: 'int unsigned'
			},
			variant_no: {
				title: '품목번호',
				type: 'int unsigned'
			},
			color: {
				title: '색상',
				type: 'char(20)'
			},
			size: {
				title: '사이즈',
				type: 'char(10)'
			}
		},
		primaryKey: ['product_no', 'variant_no']
	};

	it('인터페이스가 정상적으로 생성되어야 함', async () => {
		const generated = await generateCodes(model, {
			files: ['product_variant.yaml'],
			ts: {
				output: {
					dir: '/tmp/dao-codegen-ts/ts'
				}
			}
		});
		expect(generated).to.have.property('ts');
		expect(generated.ts).to.have.property('name', 'ProductVariant');
		expect(generated.ts).to.have.property('content', `
// DO NOT EDIT THIS FILE:
// This file is generated by dao-codegen-ts.

export interface ProductVariantData {
	/** 색상 */
	color?: string | null;
	/** 사이즈 */
	size?: string | null;
}

/** 품목정보 */
export interface ProductVariant extends ProductVariantData {
	/** 상품번호 */
	productNo: number;
	/** 품목번호 */
	variantNo: number;
}
`.trimLeft()
		);
	});

	it('SQL이 정상적으로 생성되어야 함', async () => {
		const generated = await generateCodes(model, {
			files: ['product_variant.yaml'],
			sql: {
				output: {
					dir: '/tmp/dao-codegen-ts/sql'
				}
			}
		});
		expect(generated).to.have.property('sql');
		expect(generated.sql).to.have.property('name', 'product_variant');
		expect(generated.sql).to.have.property('content', `
DROP TABLE IF EXISTS product_variant;
CREATE TABLE product_variant(
	product_no INT UNSIGNED NOT NULL, -- 상품번호
	variant_no INT UNSIGNED NOT NULL, -- 품목번호
	color CHAR(20), -- 색상
	size CHAR(10), -- 사이즈
	PRIMARY KEY(product_no, variant_no)
);
`.trimLeft()
		);
	});
});